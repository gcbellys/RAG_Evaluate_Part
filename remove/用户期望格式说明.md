# ç”¨æˆ·æœŸæœ›è¾“å‡ºæ ¼å¼è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘å·²ç»ä¿®æ”¹äº† `main_workflow.py` æ–‡ä»¶ï¼Œç°åœ¨ç³»ç»Ÿä¼šç”Ÿæˆä¸‰ç§ä¸åŒæ ¼å¼çš„è¾“å‡ºæ–‡ä»¶ï¼š

1. **è¯¦ç»†ç»“æœ** (`report_{ID}_evaluation_{timestamp}.json`) - åŸå§‹å®Œæ•´æ•°æ®
2. **æ ‡å‡†åŒ–ç»“æœ** (`report_{ID}_evaluation_standardized_{timestamp}.json`) - åŸæœ‰æ ‡å‡†åŒ–æ ¼å¼
3. **ç”¨æˆ·æ ¼å¼** (`report_{ID}_user_format_{timestamp}.json`) - æ‚¨æœŸæœ›çš„æ–°æ ¼å¼ âœ¨

## ğŸ¯ ç”¨æˆ·æœŸæœ›æ ¼å¼ç»“æ„

### å•ä¸ªç—‡çŠ¶æ¡ç›®ç»“æ„ï¼š
```json
{
  "report_number": "æŠ¥å‘Šç¼–å·",
  "symptom_number": "ç—‡çŠ¶ç¼–å·ï¼ˆ1,2,3...ï¼‰", 
  "symptom_name": "ç—‡çŠ¶åç§°",
  "expected_result": {
    "diag": "æœŸæœ›çš„è¯Šæ–­ä¿¡æ¯",
    "organ": "æœŸæœ›çš„å™¨å®˜",
    "a_position": "æœŸæœ›çš„è§£å‰–ä½ç½®"
  },
  "api_responses": [
    {
      "api_number": 1,
      "api_name": "openai",
      "api_response": {
        "organ": "APIè¯†åˆ«çš„å™¨å®˜",
        "a_position": "APIè¯†åˆ«çš„è§£å‰–ä½ç½®"
      },
      "api_eva": {
        "precision": 85.5,
        "recall": 75.0,
        "f1_score": 79.9,
        "overgeneration_penalty": 10.0,
        "overall_score": 69.9
      }
    },
    {
      "api_number": 2,
      "api_name": "anthropic",
      "api_response": {
        "organ": "APIè¯†åˆ«çš„å™¨å®˜",
        "a_position": "APIè¯†åˆ«çš„è§£å‰–ä½ç½®"
      },
      "api_eva": {
        "precision": 90.0,
        "recall": 100.0,
        "f1_score": 94.7,
        "overgeneration_penalty": 5.0,
        "overall_score": 89.7
      }
    }
    // ... å…¶ä»–APIå“åº”
  ]
}
```

## ğŸ”„ æ•°æ®æ˜ å°„å…³ç³»

| ç”¨æˆ·æœŸæœ›å­—æ®µ | æ¥æºæ•°æ® |
|-------------|---------|
| `report_number` | `report_id` |
| `symptom_number` | ç—‡çŠ¶åœ¨æŠ¥å‘Šä¸­çš„åºå·(1,2,3...) |
| `symptom_name` | `symptom.diagnosis` (ç—‡çŠ¶æ–‡æœ¬) |
| `expected_result.diag` | åˆå¹¶çš„ `d_diagnosis` ä¿¡æ¯ |
| `expected_result.organ` | åˆå¹¶çš„ `organName` ä¿¡æ¯ |
| `expected_result.a_position` | åˆå¹¶çš„ `anatomicalLocations` ä¿¡æ¯ |
| `api_response.organ` | APIå“åº”ä¸­çš„ `organ_name` |
| `api_response.a_position` | APIå“åº”ä¸­çš„ `anatomical_locations` |
| `api_eva` | å®Œæ•´çš„è¯„ä¼°æŒ‡æ ‡å¯¹è±¡ |

## ğŸ“ è¾“å‡ºæ–‡ä»¶ç‰¹ç‚¹

### ğŸ†• ç”¨æˆ·æ ¼å¼æ–‡ä»¶ç‰¹ç‚¹ï¼š
- **æ‰å¹³åŒ–ç»“æ„**ï¼šæ¯ä¸ªç—‡çŠ¶ä½œä¸ºæ•°ç»„ä¸­çš„ç‹¬ç«‹æ¡ç›®
- **æ ‡å‡†åŒ–å‘½å**ï¼šä½¿ç”¨æ‚¨æœŸæœ›çš„å­—æ®µå
- **ç»Ÿä¸€ç¼–å·**ï¼šAPIæŒ‰ç…§é¡ºåºç¼–å· (1,2,3,4,5)
- **åˆå¹¶ä¿¡æ¯**ï¼šæœŸæœ›ç»“æœä¸­çš„å¤šä¸ªæ¥æºä¿¡æ¯ä¼šåˆå¹¶å»é‡

### ğŸ“Š APIç¼–å·æ˜ å°„ï¼š
1. `openai` â†’ api_number: 1
2. `anthropic` â†’ api_number: 2  
3. `gemini` â†’ api_number: 3
4. `moonshot` â†’ api_number: 4
5. `deepseek` â†’ api_number: 5

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### è¿è¡Œç³»ç»Ÿï¼ˆä¿æŒä¸å˜ï¼‰ï¼š
```bash
# å¤„ç†å•ä¸ªæŠ¥å‘Š
python main_workflow.py --start_id 4000 --end_id 4000

# å¤„ç†èŒƒå›´æŠ¥å‘Š
python main_workflow.py --start_id 4000 --end_id 4005

# é™åˆ¶å¤„ç†æ•°é‡
python main_workflow.py --max_files 10
```

### è¾“å‡ºæ–‡ä»¶ç¤ºä¾‹ï¼š
```
results/
â”œâ”€â”€ report_diagnostic_4000_evaluation_20250821_165541.json          # è¯¦ç»†ç»“æœ
â”œâ”€â”€ report_diagnostic_4000_evaluation_standardized_20250821_165541.json  # æ ‡å‡†åŒ–ç»“æœ
â””â”€â”€ report_diagnostic_4000_user_format_20250821_165541.json        # ç”¨æˆ·æ ¼å¼ âœ¨
```

## ğŸ“‹ ç¤ºä¾‹è¾“å‡º

è¯·æŸ¥çœ‹ `example_user_format_output.json` æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†å®Œæ•´çš„ç”¨æˆ·æ ¼å¼ç¤ºä¾‹è¾“å‡ºã€‚

## ğŸ”§ æ ¸å¿ƒä¿®æ”¹

### 1. æ–°å¢æ–¹æ³•ï¼š
- `_generate_user_format()` - ç”Ÿæˆç”¨æˆ·æœŸæœ›çš„æ‰å¹³åŒ–æ ¼å¼

### 2. ä¿®æ”¹æ–¹æ³•ï¼š
- `save_results()` - å¢åŠ ç”¨æˆ·æ ¼å¼æ–‡ä»¶ä¿å­˜
- `_standardize_results()` - æ›´æ–°æ ‡å‡†åŒ–é€»è¾‘

### 3. æ•°æ®å¤„ç†å¢å¼ºï¼š
- **æ™ºèƒ½åˆå¹¶**ï¼šè‡ªåŠ¨åˆå¹¶é‡å¤çš„å™¨å®˜å’Œä½ç½®ä¿¡æ¯
- **å»é‡å¤„ç†**ï¼šé¿å…æœŸæœ›ç»“æœä¸­çš„é‡å¤é¡¹
- **é”™è¯¯ä¿ç•™**ï¼šä¿æŒåŸæœ‰çš„é”™è¯¯å¤„ç†æœºåˆ¶

## ğŸ“ˆ ä¼˜åŠ¿

1. **å®Œç¾åŒ¹é…**ï¼šè¾“å‡ºæ ¼å¼å®Œå…¨ç¬¦åˆæ‚¨çš„æœŸæœ›
2. **å‘åå…¼å®¹**ï¼šä¿ç•™åŸæœ‰çš„è¯¦ç»†å’Œæ ‡å‡†åŒ–æ ¼å¼
3. **æ•°æ®å®Œæ•´**ï¼šä¸ä¸¢å¤±ä»»ä½•è¯„ä¼°ä¿¡æ¯
4. **æ˜“äºåˆ†æ**ï¼šæ‰å¹³åŒ–ç»“æ„ä¾¿äºåç»­æ•°æ®å¤„ç†
5. **æ ‡å‡†åŒ–ç¼–å·**ï¼šAPIå“åº”æŒ‰ç»Ÿä¸€é¡ºåºç¼–å·

## ğŸ” å­—æ®µè¯¦ç»†è¯´æ˜

### `expected_result` æ„å»ºé€»è¾‘ï¼š
- **diag**: åˆå¹¶æ‰€æœ‰ç›¸å…³çš„è¯Šæ–­ä¿¡æ¯ï¼Œç”¨åˆ†å·åˆ†éš”
- **organ**: åˆå¹¶æ‰€æœ‰å™¨å®˜åç§°ï¼Œå»é‡åç”¨é€—å·åˆ†éš”  
- **a_position**: åˆå¹¶æ‰€æœ‰è§£å‰–ä½ç½®ï¼Œå»é‡åç”¨é€—å·åˆ†éš”

### `api_eva` è¯„ä¼°æŒ‡æ ‡ï¼š
- **precision**: ç²¾ç¡®ç‡ (0-100)
- **recall**: å¬å›ç‡ (0-100)
- **f1_score**: F1åˆ†æ•° (0-100)
- **overgeneration_penalty**: è¿‡åº¦ç”Ÿæˆæƒ©ç½š (0-100)
- **overall_score**: ç»¼åˆå¾—åˆ† (0-100)

ç°åœ¨æ‚¨å¯ä»¥ç›´æ¥ä½¿ç”¨ä¿®æ”¹åçš„ç³»ç»Ÿï¼Œå®ƒä¼šè‡ªåŠ¨ç”Ÿæˆæ‚¨æœŸæœ›çš„è¾“å‡ºæ ¼å¼ï¼
