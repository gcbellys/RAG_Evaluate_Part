# RAGè¯„ä¼°ç³»ç»Ÿ - å·¥ä½œæµç¨‹æŒ‡å—

## ğŸ“ é¡¹ç›®ç»“æ„

```
Rag_Evaluate/
â”œâ”€â”€ ğŸš€ ä¸»å¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ start_evaluation.py      # ä¸»å…¥å£ï¼Œæ¨èä½¿ç”¨
â”œâ”€â”€ ğŸ“ å·¥ä½œæµç¨‹ (workflows/)
â”‚   â”œâ”€â”€ main_workflow.py         # åŸºç¡€è¯„ä¼°ï¼ˆä¸å«RAGï¼‰
â”‚   â”œâ”€â”€ comparision_workflow.py  # å¯¹æ¯”å·¥ä½œæµï¼ˆåŒ…å«RAGï¼‰
â”‚   â”œâ”€â”€ rerun_with_rag.py        # RAGå¢å¼ºè¯„ä¼°ä¸»è„šæœ¬
â”‚   â””â”€â”€ run_full_pipeline.py     # å®Œæ•´æµç¨‹ç®¡é“
â”œâ”€â”€ ğŸ“ æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ src/                     # æ ¸å¿ƒä»£ç 
â”‚   â”œâ”€â”€ api_clients/             # APIå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ config/                  # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ scripts/                 # è¾…åŠ©è„šæœ¬
â”‚   â””â”€â”€ prompt/                  # æç¤ºè¯æ¨¡æ¿
â”œâ”€â”€ ğŸ“ ç»“æœç›®å½• (final_result/)
â”‚   â”œâ”€â”€ rag_search_output/       # RAGæ£€ç´¢ç¼“å­˜
â”‚   â”œâ”€â”€ baseline_results/        # åŸºç¡€è¯„ä¼°ç»“æœ
â”‚   â”œâ”€â”€ rerun_with_rag/          # RAGå¢å¼ºç»“æœ
â”‚   â””â”€â”€ rerun_comparisons/       # å¯¹æ¯”åˆ†æ
â””â”€â”€ ğŸ—‘ï¸ remove/                  # å·²æ¸…ç†çš„æ—§æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ¨èæ–¹å¼ï¼šä½¿ç”¨ä¸»å¯åŠ¨è„šæœ¬

```bash
# æŸ¥çœ‹å¸®åŠ©
python start_evaluation.py --help

# å®Œæ•´RAGè¯„ä¼°æµç¨‹ï¼ˆå•ä¸ªæŠ¥å‘Šï¼‰
python start_evaluation.py full 4000

# æ‰¹é‡è¯„ä¼°ï¼ˆèŒƒå›´ï¼‰
python start_evaluation.py full 4000 4002

# ä»…åŸºç¡€è¯„ä¼°ï¼ˆä¸å«RAGï¼‰
python start_evaluation.py baseline 4000

# ä»…RAGå¢å¼ºè¯„ä¼°ï¼ˆéœ€è¦å·²æœ‰ç¼“å­˜ï¼‰
python start_evaluation.py rag-only 4000
```

### 2. ç›´æ¥ä½¿ç”¨å·¥ä½œæµè„šæœ¬

```bash
# å®Œæ•´æµç¨‹ç®¡é“
python workflows/run_full_pipeline.py 4000

# åŸºç¡€è¯„ä¼°
python workflows/main_workflow.py --start_id 4000 --end_id 4000

# RAGå¢å¼ºè¯„ä¼°
python workflows/rerun_with_rag.py 4000
```

## ğŸ“‹ å·¥ä½œæµç¨‹è¯¦è§£

### ğŸ¯ å®Œæ•´RAGè¯„ä¼°æµç¨‹ (æ¨è)

**å‘½ä»¤**: `python start_evaluation.py full 4000`

**æ­¥éª¤**:
1. **RAGæ£€ç´¢** â†’ ç”Ÿæˆç—‡çŠ¶ç›¸å…³çš„åŒ»å­¦çŸ¥è¯†ç¼“å­˜
2. **åŸºç¡€è¯„ä¼°** â†’ è¿è¡Œä¸å«RAGçš„åŸºå‡†æµ‹è¯•ï¼ˆå¦‚æœç¼ºå¤±ï¼‰
3. **RAGå¢å¼ºè¯„ä¼°** â†’ ä½¿ç”¨RAGçŸ¥è¯†å¢å¼ºçš„è¯„ä¼°
4. **å¯¹æ¯”åˆ†æ** â†’ ç”Ÿæˆè¯¦ç»†çš„æ•ˆæœå¯¹æ¯”æŠ¥å‘Š

**è¾“å‡º**:
- `final_result/rag_search_output/` - RAGæ£€ç´¢ç¼“å­˜
- `final_result/baseline_results/` - åŸºç¡€è¯„ä¼°ç»“æœ
- `final_result/rerun_with_rag/` - RAGå¢å¼ºç»“æœ
- `final_result/rerun_comparisons/` - å®Œæ•´å¯¹æ¯”åˆ†æ

### ğŸ” ä»…åŸºç¡€è¯„ä¼°

**å‘½ä»¤**: `python start_evaluation.py baseline 4000`

**ç”¨é€”**: è·å¾—ä¸å«RAGçš„åŸºå‡†ç»“æœï¼Œç”¨äºåç»­å¯¹æ¯”

### ğŸ¤– ä»…RAGå¢å¼ºè¯„ä¼°

**å‘½ä»¤**: `python start_evaluation.py rag-only 4000`

**å‰æ**: å·²æœ‰RAGæ£€ç´¢ç¼“å­˜
**åŠŸèƒ½**: è‡ªåŠ¨æ£€æŸ¥åŸºç¡€ç»“æœï¼Œç¼ºå¤±æ—¶è‡ªåŠ¨è¡¥å……

### ğŸ” ä»…RAGæ£€ç´¢

**å‘½ä»¤**: `python start_evaluation.py retrieve 4000`

**ç”¨é€”**: ä»…ç”ŸæˆRAGæ£€ç´¢ç¼“å­˜ï¼Œä¸è¿›è¡Œè¯„ä¼°

## ğŸ“Š ç»“æœè§£è¯»

### å¯¹æ¯”åˆ†æç»“æœ

åœ¨ `final_result/rerun_comparisons/report_<id>_results_<timestamp>/` ä¸­ï¼š

1. **evaluation_summary.json** - ç®€åŒ–çš„JSONæ ¼å¼ç»“æœ
2. **rag_score_report.txt** - äººç±»å¯è¯»çš„æ•ˆæœæŠ¥å‘Š

### è¯¦ç»†æŒ‡æ ‡

- **å™¨å®˜å‡†ç¡®ç‡**: ç²¾ç¡®åŒ¹é…/éƒ¨åˆ†åŒ¹é…/é”™è¯¯
- **è§£å‰–ä½ç½®ç²¾ç¡®åº¦**: è¯†åˆ«æ­£ç¡®ç‡
- **è§£å‰–ä½ç½®å¬å›ç‡**: è¦†ç›–å®Œæ•´åº¦  
- **F1åˆ†æ•°**: ç²¾ç¡®åº¦å’Œå¬å›ç‡çš„è°ƒå’Œå¹³å‡
- **è¿‡åº¦ç”Ÿæˆæƒ©ç½š**: è¯†åˆ«å†—ä½™ä¿¡æ¯çš„æƒ©ç½š

## âš™ï¸ é…ç½®è¯´æ˜

### APIé…ç½®
ç¼–è¾‘ `config/config.yaml`:
```yaml
api_config:
  moonshot:    # å½“å‰æ¿€æ´»
  deepseek:    # å½“å‰æ¿€æ´»
  # openai:    # å·²æ³¨é‡Š
  # anthropic: # å·²æ³¨é‡Š
  # gemini:    # å·²æ³¨é‡Š
```

### è·¯å¾„é…ç½®
- RAGç´¢å¼•: `/home/duojiechen/Projects/Rag_system/Rag_Build/enhanced_faiss_indexes`
- æµ‹è¯•æ•°æ®: `test_set/`
- è¾“å‡ºç»“æœ: `final_result/`

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **RAGæ£€ç´¢å¤±è´¥**
   - æ£€æŸ¥ `Rag_Build` ç¯å¢ƒæ˜¯å¦æ­£ç¡®é…ç½®
   - ç¡®è®¤ FAISS ç´¢å¼•æ–‡ä»¶å­˜åœ¨

2. **APIè°ƒç”¨å¤±è´¥**
   - æ£€æŸ¥APIå¯†é’¥ç¯å¢ƒå˜é‡
   - ç¡®è®¤APIé…ç½®æœªè¢«æ³¨é‡Š

3. **æ–‡ä»¶è·¯å¾„é”™è¯¯**
   - ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œå‘½ä»¤
   - æ£€æŸ¥ `final_result/` ç›®å½•æƒé™

### è°ƒè¯•æ¨¡å¼

```bash
# æ·»åŠ è¯¦ç»†è¾“å‡º
python start_evaluation.py full 4000 --verbose

# é™åˆ¶æ–‡ä»¶æ•°é‡
python workflows/main_workflow.py --start_id 4000 --end_id 4000 --max_files 1
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

- **å¹¶è¡Œå¤„ç†**: è€ƒè™‘æ‰¹é‡å¤„ç†å¤šä¸ªæŠ¥å‘Š
- **ç¼“å­˜åˆ©ç”¨**: é‡å¤ä½¿ç”¨RAGæ£€ç´¢ç¼“å­˜
- **APIé€‰æ‹©**: æ ¹æ®é€Ÿåº¦éœ€æ±‚é€‰æ‹©åˆé€‚çš„API

## ğŸ”„ ç‰ˆæœ¬å†å²

- **v3.0**: æ–‡ä»¶ç»“æ„é‡ç»„ï¼Œç»Ÿä¸€å¯åŠ¨è„šæœ¬
- **v2.0**: RAGå¢å¼ºè¯„ä¼°ç³»ç»Ÿ
- **v1.0**: åŸºç¡€è¯„ä¼°ç³»ç»Ÿ
